<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Analyst Assistant - Enhanced Suite</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs-persist@1.x.x/dist/cdn.min.js" defer></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4/dist/chart.umd.js"></script>
    <style>
        [x-cloak] { display: none !important; }
    </style>
</head>
<body class="bg-gray-50">
    <div x-data="baAssistant()" x-init="init()" x-cloak class="min-h-screen">
        <!-- Header -->
        <header class="bg-white shadow-sm border-b">
            <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
                <div>
                    <h1 class="text-2xl font-bold text-gray-800">Business Analyst Assistant</h1>
                    <p class="text-sm text-gray-600">Complete BA workflow automation suite</p>
                </div>
                <div class="flex items-center gap-4">
                    <button @click="exportData()" class="text-sm text-gray-600 hover:text-gray-800">
                        üì• Export Data
                    </button>
                    <button @click="showImportDialog = true" class="text-sm text-gray-600 hover:text-gray-800">
                        üì§ Import Data
                    </button>
                    <button @click="clearAllData()" class="text-sm text-red-600 hover:text-red-800">
                        üóëÔ∏è Clear All
                    </button>
                    <span class="text-sm text-gray-500">v2.0</span>
                </div>
            </div>
        </header>

        <!-- Auth Modal -->
        <div x-show="!authenticated" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white p-8 rounded-lg shadow-xl max-w-md w-full">
                <h2 class="text-xl font-bold mb-4">Enter Access Code</h2>
                <input 
                    type="password"
                    x-model="passcode"
                    @keyup.enter="authenticate"
                    class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                    placeholder="Enter passcode"
                >
                <button 
                    @click="authenticate"
                    class="w-full mt-4 bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition-colors"
                >
                    Access
                </button>
                <p x-show="authError" class="text-red-500 text-sm mt-2" x-text="authError"></p>
            </div>
        </div>

        <!-- Import Dialog -->
        <div x-show="showImportDialog" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white p-8 rounded-lg shadow-xl max-w-md w-full">
                <h2 class="text-xl font-bold mb-4">Import Data</h2>
                <input 
                    type="file"
                    @change="handleImportFile"
                    accept=".json"
                    class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"
                >
                <div class="mt-4 flex gap-2 justify-end">
                    <button 
                        @click="showImportDialog = false"
                        class="px-4 py-2 text-gray-600 hover:text-gray-800"
                    >
                        Cancel
                    </button>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <main x-show="authenticated" class="max-w-7xl mx-auto px-4 py-8">
            <!-- Navigation Tabs -->
            <div class="bg-white rounded-lg shadow-md mb-6">
                <div class="flex overflow-x-auto">
                    <button 
                        @click="mainTab = 'analyze'"
                        :class="mainTab === 'analyze' ? 'bg-blue-600 text-white' : 'text-gray-600 hover:bg-gray-100'"
                        class="px-6 py-3 font-medium transition-colors whitespace-nowrap"
                    >
                        üéØ Analyze Meeting
                    </button>
                    <button 
                        @click="mainTab = 'history'"
                        :class="mainTab === 'history' ? 'bg-blue-600 text-white' : 'text-gray-600 hover:bg-gray-100'"
                        class="px-6 py-3 font-medium transition-colors whitespace-nowrap"
                    >
                        üìä Meeting History
                        <span x-show="meetingHistory.length > 0" class="ml-2 bg-gray-200 text-gray-700 px-2 py-1 rounded-full text-xs" x-text="meetingHistory.length"></span>
                    </button>
                    <button 
                        @click="mainTab = 'documents'"
                        :class="mainTab === 'documents' ? 'bg-blue-600 text-white' : 'text-gray-600 hover:bg-gray-100'"
                        class="px-6 py-3 font-medium transition-colors whitespace-nowrap"
                        :disabled="!results && selectedMeetings.length === 0"
                    >
                        üìÑ Generate Docs
                    </button>
                    <button 
                        @click="mainTab = 'tests'"
                        :class="mainTab === 'tests' ? 'bg-blue-600 text-white' : 'text-gray-600 hover:bg-gray-100'"
                        class="px-6 py-3 font-medium transition-colors whitespace-nowrap"
                        :disabled="!results || !results.requirements || results.requirements.length === 0"
                    >
                        üß™ Test Cases
                    </button>
                    <button 
                        @click="mainTab = 'visualize'"
                        :class="mainTab === 'visualize' ? 'bg-blue-600 text-white' : 'text-gray-600 hover:bg-gray-100'"
                        class="px-6 py-3 font-medium transition-colors whitespace-nowrap disabled:opacity-50"
                        disabled
                    >
                        üîÑ Process Flow (Coming Soon)
                    </button>
                    <button 
                        @click="mainTab = 'raid'"
                        :class="mainTab === 'raid' ? 'bg-blue-600 text-white' : 'text-gray-600 hover:bg-gray-100'"
                        class="px-6 py-3 font-medium transition-colors whitespace-nowrap disabled:opacity-50"
                        disabled
                    >
                        ‚ö° RAID Log (Coming Soon)
                    </button>
                </div>
            </div>

            <!-- Analyze Tab -->
            <div x-show="mainTab === 'analyze'">
                <!-- Input Section -->
                <div class="bg-white rounded-lg shadow-md p-6 mb-8">
                    <h2 class="text-xl font-semibold mb-4">Upload Meeting Transcript</h2>
                    
                    <!-- Meeting Type -->
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Meeting Type</label>
                        <select 
                            x-model="meetingType"
                            class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                        >
                            <option value="">Select meeting type...</option>
                            <option value="standup">Daily Stand-up</option>
                            <option value="planning">Sprint Planning</option>
                            <option value="review">Sprint Review</option>
                            <option value="elicitation">Requirements Elicitation</option>
                            <option value="retro">Retrospective</option>
                            <option value="refinement">Backlog Refinement</option>
                            <option value="stakeholder">Stakeholder Meeting</option>
                            <option value="training">Training Lecture (BA-X)</option>
                            <option value="other">Other</option>
                        </select>
                    </div>

                    <!-- Model Selection -->
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">AI Model</label>
                        <select 
                            x-model="selectedModel"
                            class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                        >
                            <option value="gemini-2.5-flash-preview-05-20">Gemini 2.5 Flash (Faster)</option>
                            <option value="gemini-2.5-pro-preview-06-05">Gemini 2.5 Pro (More Powerful)</option>
                        </select>
                    </div>

                    <!-- Transcript Input -->
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Transcript</label>
                        
                        <!-- File Upload -->
                        <div class="mb-3">
                            <input 
                                type="file"
                                @change="handleFileUpload"
                                accept=".txt"
                                class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"
                            >
                        </div>

                        <!-- Text Area -->
                        <textarea 
                            x-model="transcript"
                            rows="10"
                            class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                            placeholder="Or paste your meeting transcript here..."
                        ></textarea>
                    </div>

                    <!-- Analyze Button -->
                    <button 
                        @click="analyzeTranscript"
                        :disabled="loading || !meetingType || !transcript"
                        class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed"
                    >
                        <span x-show="!loading">Analyze Transcript</span>
                        <span x-show="loading" class="inline-flex items-center">
                            <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                            Analyzing...
                        </span>
                    </button>

                    <p x-show="error" class="text-red-500 text-sm mt-2" x-text="error"></p>
                </div>

                <!-- Results Section -->
                <div x-show="results" class="bg-white rounded-lg shadow-md p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-semibold">Analysis Results</h2>
                        
                        <!-- Action Buttons -->
                        <div class="flex gap-2">
                            <button 
                                @click="addMeetingToHistory(results)"
                                class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors text-sm"
                            >
                                üíæ Save to History
                            </button>
                            <button 
                                @click="copyAllToClipboard"
                                class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors text-sm"
                            >
                                üìã Copy All
                            </button>
                            <button 
                                @click="downloadResults"
                                class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm"
                            >
                                üíæ Download
                            </button>
                            <button 
                                @click="emailResults"
                                class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm"
                            >
                                ‚úâÔ∏è Email
                            </button>
                        </div>
                    </div>

                    <!-- Summary Section -->
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold mb-2">Executive Summary</h3>
                        <p class="text-gray-700 bg-gray-50 p-4 rounded-lg" x-text="results.summary"></p>
                    </div>

                    <!-- Tabs for Different Result Types -->
                    <div class="border-b mb-4">
                        <nav class="flex -mb-px">
                            <!-- Standard Meeting Tabs -->
                            <template x-if="results?.meeting_type !== 'training'">
                                <div class="flex">
                                    <button 
                                        @click="activeTab = 'recap'"
                                        :class="activeTab === 'recap' ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-500 hover:text-gray-700'"
                                        class="py-2 px-4 font-medium text-sm"
                                    >
                                        Recap
                                    </button>
                                    <button 
                                        @click="activeTab = 'action_items'"
                                        :class="activeTab === 'action_items' ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-500 hover:text-gray-700'"
                                        class="py-2 px-4 font-medium text-sm"
                                    >
                                        Action Items
                                        <span x-show="results.action_items?.length > 0" class="ml-1 bg-red-100 text-red-600 px-2 py-1 rounded-full text-xs" x-text="results.action_items.length"></span>
                                    </button>
                                    <button 
                                        @click="activeTab = 'decisions'"
                                        :class="activeTab === 'decisions' ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-500 hover:text-gray-700'"
                                        class="py-2 px-4 font-medium text-sm"
                                    >
                                        Decisions
                                        <span x-show="results.decisions?.length > 0" class="ml-1 bg-green-100 text-green-600 px-2 py-1 rounded-full text-xs" x-text="results.decisions.length"></span>
                                    </button>
                                    <button 
                                        @click="activeTab = 'risks'"
                                        :class="activeTab === 'risks' ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-500 hover:text-gray-700'"
                                        class="py-2 px-4 font-medium text-sm"
                                    >
                                        Risks
                                        <span x-show="results.risks?.length > 0" class="ml-1 bg-yellow-100 text-yellow-600 px-2 py-1 rounded-full text-xs" x-text="results.risks.length"></span>
                                    </button>
                                    <button 
                                        @click="activeTab = 'requirements'"
                                        :class="activeTab === 'requirements' ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-500 hover:text-gray-700'"
                                        class="py-2 px-4 font-medium text-sm"
                                    >
                                        Requirements
                                        <span x-show="results.requirements?.length > 0" class="ml-1 bg-purple-100 text-purple-600 px-2 py-1 rounded-full text-xs" x-text="results.requirements.length"></span>
                                    </button>
                                    <button 
                                        @click="activeTab = 'questions'"
                                        :class="activeTab === 'questions' ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-500 hover:text-gray-700'"
                                        class="py-2 px-4 font-medium text-sm"
                                    >
                                        Questions
                                    </button>
                                    <button 
                                        @click="activeTab = 'next_steps'"
                                        :class="activeTab === 'next_steps' ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-500 hover:text-gray-700'"
                                        class="py-2 px-4 font-medium text-sm"
                                    >
                                        Next Steps
                                    </button>
                                </div>
                            </template>

                            <!-- Training Meeting Tabs -->
                            <template x-if="results?.meeting_type === 'training'">
                                <div class="flex flex-wrap">
                                    <button 
                                        @click="activeTab = 'objectives'"
                                        :class="activeTab === 'objectives' ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-500 hover:text-gray-700'"
                                        class="py-2 px-4 font-medium text-sm"
                                    >
                                        Learning Objectives
                                    </button>
                                    <button 
                                        @click="activeTab = 'concepts'"
                                        :class="activeTab === 'concepts' ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-500 hover:text-gray-700'"
                                        class="py-2 px-4 font-medium text-sm"
                                    >
                                        Concepts
                                    </button>
                                    <button 
                                        @click="activeTab = 'tools'"
                                        :class="activeTab === 'tools' ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-500 hover:text-gray-700'"
                                        class="py-2 px-4 font-medium text-sm"
                                    >
                                        Tools
                                    </button>
                                    <button 
                                        @click="activeTab = 'examples'"
                                        :class="activeTab === 'examples' ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-500 hover:text-gray-700'"
                                        class="py-2 px-4 font-medium text-sm"
                                    >
                                        Examples
                                    </button>
                                    <button 
                                        @click="activeTab = 'exercises'"
                                        :class="activeTab === 'exercises' ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-500 hover:text-gray-700'"
                                        class="py-2 px-4 font-medium text-sm"
                                    >
                                        Exercises
                                    </button>
                                    <button 
                                        @click="activeTab = 'qa'"
                                        :class="activeTab === 'qa' ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-500 hover:text-gray-700'"
                                        class="py-2 px-4 font-medium text-sm"
                                    >
                                        Q&A
                                    </button>
                                    <button 
                                        @click="activeTab = 'resources'"
                                        :class="activeTab === 'resources' ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-500 hover:text-gray-700'"
                                        class="py-2 px-4 font-medium text-sm"
                                    >
                                        Resources
                                    </button>
                                </div>
                            </template>
                        </nav>
                    </div>

                    <!-- Tab Content -->
                    <div class="mt-4">
                        <!-- Standard Meeting Content -->
                        <template x-if="results?.meeting_type !== 'training'">
                            <div>
                                <!-- Recap -->
                                <div x-show="activeTab === 'recap'">
                                    <h3 class="text-lg font-semibold mb-2">Detailed Recap</h3>
                                    <p class="text-gray-700 whitespace-pre-wrap" x-text="results.recap"></p>
                                </div>

                                <!-- Action Items -->
                                <div x-show="activeTab === 'action_items'">
                                    <h3 class="text-lg font-semibold mb-2">Action Items</h3>
                                    <ul class="space-y-2">
                                        <template x-for="item in results.action_items">
                                            <li class="flex items-start">
                                                <span class="text-red-500 mr-2">‚ö°</span>
                                                <span x-text="item" class="text-gray-700"></span>
                                            </li>
                                        </template>
                                    </ul>
                                </div>

                                <!-- Decisions -->
                                <div x-show="activeTab === 'decisions'">
                                    <h3 class="text-lg font-semibold mb-2">Decisions Made</h3>
                                    <ul class="space-y-2">
                                        <template x-for="item in results.decisions">
                                            <li class="flex items-start">
                                                <span class="text-green-500 mr-2">‚úì</span>
                                                <span x-text="item" class="text-gray-700"></span>
                                            </li>
                                        </template>
                                    </ul>
                                </div>

                                <!-- Risks -->
                                <div x-show="activeTab === 'risks'">
                                    <h3 class="text-lg font-semibold mb-2">Risks & Issues</h3>
                                    <ul class="space-y-2">
                                        <template x-for="item in results.risks">
                                            <li class="flex items-start">
                                                <span class="text-yellow-500 mr-2">‚ö†Ô∏è</span>
                                                <span x-text="item" class="text-gray-700"></span>
                                            </li>
                                        </template>
                                    </ul>
                                </div>

                                <!-- Requirements -->
                                <div x-show="activeTab === 'requirements'">
                                    <h3 class="text-lg font-semibold mb-2">Requirements</h3>
                                    <ul class="space-y-2">
                                        <template x-for="(item, index) in results.requirements">
                                            <li class="flex items-start bg-purple-50 p-3 rounded-lg">
                                                <span class="text-purple-600 mr-2 font-semibold">R<span x-text="index + 1"></span>:</span>
                                                <span x-text="item" class="text-gray-700"></span>
                                            </li>
                                        </template>
                                    </ul>
                                </div>

                                <!-- Questions -->
                                <div x-show="activeTab === 'questions'">
                                    <h3 class="text-lg font-semibold mb-2">Open Questions</h3>
                                    <ul class="space-y-2">
                                        <template x-for="item in results.open_questions">
                                            <li class="flex items-start">
                                                <span class="text-blue-500 mr-2">‚ùì</span>
                                                <span x-text="item" class="text-gray-700"></span>
                                            </li>
                                        </template>
                                    </ul>
                                </div>

                                <!-- Next Steps -->
                                <div x-show="activeTab === 'next_steps'">
                                    <h3 class="text-lg font-semibold mb-2">Next Steps</h3>
                                    <ul class="space-y-2">
                                        <template x-for="item in results.next_steps">
                                            <li class="flex items-start">
                                                <span class="text-indigo-500 mr-2">‚Üí</span>
                                                <span x-text="item" class="text-gray-700"></span>
                                            </li>
                                        </template>
                                    </ul>
                                    <div class="mt-4" x-show="results.dependencies?.length > 0">
                                        <h4 class="font-medium mb-2">Dependencies:</h4>
                                        <ul class="space-y-1">
                                            <template x-for="item in results.dependencies">
                                                <li class="flex items-start">
                                                    <span class="text-gray-500 mr-2">üîó</span>
                                                    <span x-text="item" class="text-gray-700"></span>
                                                </li>
                                            </template>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </template>

                        <!-- Training Meeting Content -->
                        <template x-if="results?.meeting_type === 'training'">
                            <div>
                                <!-- Learning Objectives -->
                                <div x-show="activeTab === 'objectives'">
                                    <h3 class="text-lg font-semibold mb-2">Learning Objectives</h3>
                                    <ul class="space-y-2">
                                        <template x-for="item in results?.learning_objectives || []">
                                            <li class="flex items-start">
                                                <span class="text-blue-500 mr-2">üéØ</span>
                                                <span x-text="item" class="text-gray-700"></span>
                                            </li>
                                        </template>
                                    </ul>
                                </div>

                                <!-- Concepts -->
                                <div x-show="activeTab === 'concepts'">
                                    <h3 class="text-lg font-semibold mb-2">Concepts Covered</h3>
                                    <ul class="space-y-2">
                                        <template x-for="item in results?.concepts_covered || []">
                                            <li class="flex items-start">
                                                <span class="text-purple-500 mr-2">üí°</span>
                                                <span x-text="item" class="text-gray-700"></span>
                                            </li>
                                        </template>
                                    </ul>
                                </div>

                                <!-- Tools -->
                                <div x-show="activeTab === 'tools'">
                                    <h3 class="text-lg font-semibold mb-2">Tools & Techniques Demonstrated</h3>
                                    <ul class="space-y-2">
                                        <template x-for="item in results?.tools_demonstrated || []">
                                            <li class="flex items-start">
                                                <span class="text-green-500 mr-2">üîß</span>
                                                <span x-text="item" class="text-gray-700"></span>
                                            </li>
                                        </template>
                                    </ul>
                                </div>

                                <!-- Examples -->
                                <div x-show="activeTab === 'examples'">
                                    <h3 class="text-lg font-semibold mb-2">Examples & Case Studies</h3>
                                    <ul class="space-y-2">
                                        <template x-for="item in results?.examples_presented || []">
                                            <li class="flex items-start">
                                                <span class="text-orange-500 mr-2">üìã</span>
                                                <span x-text="item" class="text-gray-700"></span>
                                            </li>
                                        </template>
                                    </ul>
                                </div>

                                <!-- Exercises -->
                                <div x-show="activeTab === 'exercises'">
                                    <h3 class="text-lg font-semibold mb-2">Exercises & Assignments</h3>
                                    <ul class="space-y-2">
                                        <template x-for="item in results?.exercises_assigned || []">
                                            <li class="flex items-start">
                                                <span class="text-red-500 mr-2">‚úèÔ∏è</span>
                                                <span x-text="item" class="text-gray-700"></span>
                                            </li>
                                        </template>
                                    </ul>
                                </div>

                                <!-- Q&A -->
                                <div x-show="activeTab === 'qa'">
                                    <h3 class="text-lg font-semibold mb-2">Q&A Highlights</h3>
                                    <ul class="space-y-2">
                                        <template x-for="item in results?.qa_highlights || []">
                                            <li class="flex items-start">
                                                <span class="text-yellow-500 mr-2">‚ùì</span>
                                                <span x-text="item" class="text-gray-700"></span>
                                            </li>
                                        </template>
                                    </ul>
                                </div>

                                <!-- Resources -->
                                <div x-show="activeTab === 'resources'">
                                    <h3 class="text-lg font-semibold mb-2">Resources & References</h3>
                                    <ul class="space-y-2">
                                        <template x-for="item in results?.resources_shared || []">
                                            <li class="flex items-start">
                                                <span class="text-indigo-500 mr-2">üìñ</span>
                                                <span x-text="item" class="text-gray-700"></span>
                                            </li>
                                        </template>
                                    </ul>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
            </div>

            <!-- Meeting History Tab -->
            <div x-show="mainTab === 'history'" x-data="MeetingHistoryComponent()">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-semibold">Meeting History</h2>
                        <div class="flex gap-2">
                            <input 
                                type="text"
                                x-model="searchQuery"
                                placeholder="Search meetings..."
                                class="px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                            >
                            <select 
                                x-model="filterType"
                                class="px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                            >
                                <option value="all">All Types</option>
                                <option value="standup">Stand-ups</option>
                                <option value="planning">Planning</option>
                                <option value="review">Reviews</option>
                                <option value="elicitation">Elicitation</option>
                                <option value="retro">Retros</option>
                                <option value="refinement">Refinement</option>
                                <option value="stakeholder">Stakeholder</option>
                                <option value="training">Training</option>
                                <option value="other">Other</option>
                            </select>
                            <button 
                                @click="exportSelected()"
                                :disabled="$store.baAssistant.selectedMeetings.length === 0"
                                class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:bg-gray-400"
                            >
                                Export Selected
                            </button>
                        </div>
                    </div>

                    <!-- Meeting List -->
                    <div class="space-y-4">
                        <template x-for="meeting in filteredMeetings" :key="meeting.id">
                            <div class="border rounded-lg p-4 hover:shadow-md transition-shadow">
                                <div class="flex justify-between items-start">
                                    <div class="flex-1">
                                        <div class="flex items-center gap-2 mb-2">
                                            <input 
                                                type="checkbox"
                                                :checked="isSelected(meeting.id)"
                                                @change="toggleSelection(meeting.id)"
                                                class="rounded text-blue-600 focus:ring-blue-500"
                                            >
                                            <span class="font-semibold" x-text="meetingTypeLabels[meeting.metadata?.meetingType] || 'Meeting'"></span>
                                            <span class="text-sm text-gray-500" x-text="getMeetingAge(meeting.timestamp)"></span>
                                        </div>
                                        <p class="text-gray-700 mb-2" x-text="meeting.summary"></p>
                                        <div class="flex gap-4 text-sm text-gray-600">
                                            <span>üìã <span x-text="getItemCounts(meeting).actions"></span> actions</span>
                                            <span>üìÑ <span x-text="getItemCounts(meeting).requirements"></span> requirements</span>
                                            <span>‚ö†Ô∏è <span x-text="getItemCounts(meeting).risks"></span> risks</span>
                                            <span>‚úì <span x-text="getItemCounts(meeting).decisions"></span> decisions</span>
                                        </div>
                                    </div>
                                    <div class="flex gap-2 ml-4">
                                        <button 
                                            @click="loadMeeting(meeting)"
                                            class="text-blue-600 hover:text-blue-800"
                                            title="Load in analyzer"
                                        >
                                            üëÅÔ∏è
                                        </button>
                                        <button 
                                            @click="toggleDetails(meeting.id)"
                                            class="text-gray-600 hover:text-gray-800"
                                        >
                                            üîΩ
                                        </button>
                                        <button 
                                            @click="deleteMeeting(meeting.id)"
                                            class="text-red-600 hover:text-red-800"
                                        >
                                            üóëÔ∏è
                                        </button>
                                    </div>
                                </div>

                                <!-- Expandable Details -->
                                <div x-show="showDetails[meeting.id]" class="mt-4 pt-4 border-t">
                                    <div class="grid grid-cols-2 gap-4">
                                        <div>
                                            <h4 class="font-semibold mb-2">Action Items</h4>
                                            <ul class="text-sm space-y-1">
                                                <template x-for="item in meeting.actionItems || []">
                                                    <li class="text-gray-700">‚Ä¢ <span x-text="item"></span></li>
                                                </template>
                                            </ul>
                                        </div>
                                        <div>
                                            <h4 class="font-semibold mb-2">Requirements</h4>
                                            <ul class="text-sm space-y-1">
                                                <template x-for="item in meeting.requirements || []">
                                                    <li class="text-gray-700">‚Ä¢ <span x-text="item"></span></li>
                                                </template>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>

                    <div x-show="filteredMeetings.length === 0" class="text-center py-8 text-gray-500">
                        No meetings found. Start by analyzing a meeting transcript.
                    </div>
                </div>
            </div>

            <!-- Document Generator Tab -->
            <div x-show="mainTab === 'documents'" x-data="DocumentGeneratorComponent()">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-xl font-semibold mb-6">Generate Documents</h2>

                    <div class="grid grid-cols-2 gap-6">
                        <!-- Template Selection -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Document Template</label>
                            <div class="space-y-2">
                                <template x-for="(template, key) in templates">
                                    <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50" :class="selectedTemplate === key ? 'border-blue-500 bg-blue-50' : ''">
                                        <input 
                                            type="radio"
                                            :value="key"
                                            x-model="selectedTemplate"
                                            class="mr-3 text-blue-600 focus:ring-blue-500"
                                        >
                                        <span x-text="template.icon" class="mr-2"></span>
                                        <span x-text="template.name"></span>
                                    </label>
                                </template>
                            </div>
                        </div>

                        <!-- Document Settings -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Document Settings</label>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm text-gray-600 mb-1">Document Title</label>
                                    <input 
                                        type="text"
                                        x-model="documentTitle"
                                        class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    >
                                </div>
                                <div>
                                    <label class="block text-sm text-gray-600 mb-1">Version</label>
                                    <input 
                                        type="text"
                                        x-model="documentVersion"
                                        class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    >
                                </div>
                                <label class="flex items-center">
                                    <input 
                                        type="checkbox"
                                        x-model="includeMetadata"
                                        class="rounded text-blue-600 focus:ring-blue-500 mr-2"
                                    >
                                    <span class="text-sm text-gray-700">Include metadata (date, version, etc.)</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Data Source -->
                    <div class="mt-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Data Source</label>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <div x-show="$store.baAssistant.results" class="mb-3">
                                <label class="flex items-center">
                                    <input type="radio" name="dataSource" value="current" checked class="mr-2 text-blue-600 focus:ring-blue-500">
                                    <span class="text-sm">Current analysis (<span x-text="requirementsCount"></span> requirements)</span>
                                </label>
                            </div>
                            <div x-show="selectedMeetingsCount > 0">
                                <label class="flex items-center">
                                    <input type="radio" name="dataSource" value="selected" class="mr-2 text-blue-600 focus:ring-blue-500">
                                    <span class="text-sm">Selected meetings from history (<span x-text="selectedMeetingsCount"></span> meetings)</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Generate Button -->
                    <div class="mt-6 flex gap-4">
                        <button 
                            @click="generateDocument()"
                            :disabled="generatingDoc"
                            class="flex-1 bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition-colors disabled:bg-gray-400"
                        >
                            <span x-show="!generatingDoc">Generate Document</span>
                            <span x-show="generatingDoc">Generating...</span>
                        </button>
                        <button 
                            @click="previewDocument()"
                            class="px-6 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors"
                        >
                            Preview
                        </button>
                    </div>
                </div>
            </div>

            <!-- Test Generator Tab -->
            <div x-show="mainTab === 'tests'" x-data="TestGeneratorComponent()">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-xl font-semibold mb-6">Generate Test Cases</h2>

                    <div class="grid grid-cols-2 gap-6">
                        <!-- Requirements Selection -->
                        <div>
                            <div class="flex justify-between items-center mb-2">
                                <label class="text-sm font-medium text-gray-700">Select Requirements</label>
                                <div class="text-sm">
                                    <button @click="selectAllRequirements()" class="text-blue-600 hover:text-blue-800 mr-2">Select All</button>
                                    <button @click="clearSelection()" class="text-gray-600 hover:text-gray-800">Clear</button>
                                </div>
                            </div>
                            <div class="border rounded-lg p-4 max-h-96 overflow-y-auto">
                                <template x-for="(req, index) in $store.baAssistant.results?.requirements || []">
                                    <label class="flex items-start mb-3 cursor-pointer hover:bg-gray-50 p-2 rounded">
                                        <input 
                                            type="checkbox"
                                            :checked="isRequirementSelected(index)"
                                            @change="toggleRequirement(index)"
                                            class="mt-1 mr-3 rounded text-blue-600 focus:ring-blue-500"
                                        >
                                        <span class="text-sm text-gray-700" x-text="req"></span>
                                    </label>
                                </template>
                            </div>
                        </div>

                        <!-- Test Settings -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Test Settings</label>
                            <div class="space-y-4">
                                <div>
                                    <label class="text-sm text-gray-600 mb-2 block">Test Types</label>
                                    <div class="space-y-2">
                                        <label class="flex items-center">
                                            <input 
                                                type="checkbox"
                                                x-model="testTypes.happy"
                                                class="rounded text-blue-600 focus:ring-blue-500 mr-2"
                                            >
                                            <span class="text-sm">üòä Happy Path Tests</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input 
                                                type="checkbox"
                                                x-model="testTypes.edge"
                                                class="rounded text-blue-600 focus:ring-blue-500 mr-2"
                                            >
                                            <span class="text-sm">‚ö†Ô∏è Edge Case Tests</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input 
                                                type="checkbox"
                                                x-model="testTypes.negative"
                                                class="rounded text-blue-600 focus:ring-blue-500 mr-2"
                                            >
                                            <span class="text-sm">‚ùå Negative Tests</span>
                                        </label>
                                    </div>
                                </div>

                                <div>
                                    <label class="text-sm text-gray-600 mb-2 block">Output Format</label>
                                    <select 
                                        x-model="testFormat"
                                        class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    >
                                        <option value="standard">Standard Test Cases</option>
                                        <option value="bdd">BDD Scenarios (Given/When/Then)</option>
                                        <option value="excel">Excel/CSV Format</option>
                                    </select>
                                </div>

                                <label class="flex items-center">
                                    <input 
                                        type="checkbox"
                                        x-model="includeTestData"
                                        class="rounded text-blue-600 focus:ring-blue-500 mr-2"
                                    >
                                    <span class="text-sm">Include test data suggestions</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Generate Button -->
                    <div class="mt-6">
                        <button 
                            @click="generateTestCases()"
                            :disabled="generatingTests || selectedRequirements.length === 0"
                            class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition-colors disabled:bg-gray-400"
                        >
                            <span x-show="!generatingTests">Generate Test Cases</span>
                            <span x-show="generatingTests">Generating...</span>
                        </button>
                    </div>

                    <!-- Generated Tests -->
                    <div x-show="generatedTests.length > 0" class="mt-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold">Generated Test Cases (<span x-text="generatedTests.length"></span>)</h3>
                            <button 
                                @click="exportTestCases()"
                                class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors"
                            >
                                Export Tests
                            </button>
                        </div>

                        <div class="space-y-4">
                            <template x-for="test in generatedTests">
                                <div class="border rounded-lg p-4">
                                    <div class="flex justify-between items-start mb-2">
                                        <div class="flex items-center gap-2">
                                            <span x-text="getTestTypeIcon(test.type)" class="text-xl"></span>
                                            <span class="font-semibold" x-text="test.id"></span>
                                        </div>
                                        <button 
                                            @click="copyTest(test)"
                                            class="text-gray-600 hover:text-gray-800"
                                        >
                                            üìã
                                        </button>
                                    </div>
                                    <p class="text-gray-700 mb-2" x-text="test.description"></p>
                                    <div class="text-sm text-gray-600">
                                        <p class="mb-1"><strong>Steps:</strong></p>
                                        <ol class="list-decimal list-inside space-y-1">
                                            <template x-for="step in test.steps">
                                                <li x-text="step"></li>
                                            </template>
                                        </ol>
                                        <p class="mt-2"><strong>Expected Result:</strong> <span x-text="test.expectedResult"></span></p>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script type="module">
        // Import modules
        import { createStore } from './js/state/store.js';
        import { StorageService } from './js/services/storage.js';
        import { DocumentGeneratorComponent } from './js/components/document-generator.js';
        import { MeetingHistoryComponent } from './js/components/meeting-history.js';
        import { TestGeneratorComponent } from './js/components/test-generator.js';

        // Make components available to Alpine
        window.DocumentGeneratorComponent = DocumentGeneratorComponent;
        window.MeetingHistoryComponent = MeetingHistoryComponent;
        window.TestGeneratorComponent = TestGeneratorComponent;

        function baAssistant() {
            return {
                ...createStore(),
                
                // UI state
                mainTab: 'analyze',
                activeTab: 'recap',
                showImportDialog: false,
                
                // Initialize
                init() {
                    // Check if authenticated
                    const savedPasscode = sessionStorage.getItem('ba_passcode');
                    if (savedPasscode) {
                        this.passcode = savedPasscode;
                        this.authenticated = true;
                    }
                    
                    // Load persisted state
                    this.loadState();
                    
                    // Initialize Mermaid
                    mermaid.initialize({ startOnLoad: true });
                },
                
                authenticate() {
                    sessionStorage.setItem('ba_passcode', this.passcode);
                    this.authenticated = true;
                    this.authError = '';
                },
                
                async handleFileUpload(event) {
                    const file = event.target.files[0];
                    if (file) {
                        try {
                            const text = await file.text();
                            this.transcript = text;
                        } catch (error) {
                            console.error('Error reading file:', error);
                            this.error = 'Error reading file';
                        }
                    }
                },
                
                async handleImportFile(event) {
                    const file = event.target.files[0];
                    if (file) {
                        await this.importData(file);
                        this.showImportDialog = false;
                    }
                },
                
                async analyzeTranscript() {
                    if (!this.meetingType || !this.transcript) {
                        this.error = 'Please select a meeting type and provide a transcript';
                        return;
                    }
                    
                    this.loading = true;
                    this.error = '';
                    
                    try {
                        const response = await fetch('/api/analyze', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'x-passcode': this.passcode
                            },
                            body: JSON.stringify({
                                meetingType: this.meetingType,
                                transcript: this.transcript,
                                model: this.selectedModel
                            })
                        });
                        
                        if (!response.ok) {
                            const errorData = await response.json();
                            throw new Error(errorData.error || 'Analysis failed');
                        }
                        
                        const data = await response.json();
                        this.results = data;
                        
                        // Auto-save to history if successful
                        if (this.results) {
                            const meetingId = this.addMeetingToHistory(this.results);
                            console.log('Meeting saved with ID:', meetingId);
                        }
                        
                    } catch (err) {
                        console.error('Error:', err);
                        this.error = err.message;
                        if (err.message.includes('Invalid passcode')) {
                            this.authenticated = false;
                            sessionStorage.removeItem('ba_passcode');
                        }
                    } finally {
                        this.loading = false;
                    }
                },
                
                formatResultsAsText() {
                    if (!this.results) return '';
                    
                    if (this.results.meeting_type === 'training') {
                        let text = `BA-X TRAINING LECTURE ANALYSIS
Meeting Type: ${this.meetingType.toUpperCase()}
Generated: ${new Date().toLocaleString()}

SUMMARY
${this.results.summary}

LEARNING OBJECTIVES
${(this.results.learning_objectives || []).map(item => '‚Ä¢ ' + item).join('\n')}

CONCEPTS COVERED
${(this.results.concepts_covered || []).map(item => '‚Ä¢ ' + item).join('\n')}

TOOLS & TECHNIQUES DEMONSTRATED
${(this.results.tools_demonstrated || []).map(item => '‚Ä¢ ' + item).join('\n')}

EXAMPLES & CASE STUDIES
${(this.results.examples_presented || []).map(item => '‚Ä¢ ' + item).join('\n')}

EXERCISES & ASSIGNMENTS
${(this.results.exercises_assigned || []).map(item => '‚Ä¢ ' + item).join('\n')}

Q&A HIGHLIGHTS
${(this.results.qa_highlights || []).map(item => '‚Ä¢ ' + item).join('\n')}

RESOURCES & REFERENCES
${(this.results.resources_shared || []).map(item => '‚Ä¢ ' + item).join('\n')}

SKILL ASSESSMENTS
${(this.results.skill_assessments || []).map(item => '‚Ä¢ ' + item).join('\n')}

PREREQUISITES
${(this.results.prerequisites || []).map(item => '‚Ä¢ ' + item).join('\n')}

IMPORTANT DATES
${(this.results.important_dates || []).map(item => '‚Ä¢ ' + item).join('\n')}

FOLLOW-UP TOPICS
${(this.results.follow_up_topics || []).map(item => '‚Ä¢ ' + item).join('\n')}
`;
                        return text;
                    } else {
                        let text = `BUSINESS ANALYST MEETING ANALYSIS
Meeting Type: ${this.meetingType.toUpperCase()}
Generated: ${new Date().toLocaleString()}

EXECUTIVE SUMMARY
${this.results.summary}

DETAILED RECAP
${this.results.recap}

ACTION ITEMS
${this.results.action_items.map(item => '‚Ä¢ ' + item).join('\n')}

DECISIONS MADE
${this.results.decisions.map(item => '‚Ä¢ ' + item).join('\n')}

RISKS & ISSUES
${this.results.risks.map(item => '‚Ä¢ ' + item).join('\n')}

REQUIREMENTS
${this.results.requirements.map(item => '‚Ä¢ ' + item).join('\n')}

OPEN QUESTIONS
${this.results.open_questions.map(item => '‚Ä¢ ' + item).join('\n')}

IMPORTANT DATES
${(this.results.important_dates || []).map(item => '‚Ä¢ ' + item).join('\n')}

NEXT STEPS
${this.results.next_steps.map(item => '‚Ä¢ ' + item).join('\n')}

DEPENDENCIES
${this.results.dependencies.map(item => '‚Ä¢ ' + item).join('\n')}
`;
                        return text;
                    }
                },
                
                copyAllToClipboard() {
                    const text = this.formatResultsAsText();
                    navigator.clipboard.writeText(text).then(() => {
                        // Show success feedback
                        const button = event.target;
                        const originalText = button.textContent;
                        button.textContent = '‚úì Copied!';
                        setTimeout(() => {
                            button.textContent = originalText;
                        }, 2000);
                    });
                },
                
                downloadResults() {
                    const text = this.formatResultsAsText();
                    const timestamp = new Date().toISOString().split('T')[0];
                    const filename = `ba-analysis-${this.meetingType}-${timestamp}.txt`;
                    
                    const blob = new Blob([text], { type: 'text/plain' });
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = filename;
                    a.click();
                    window.URL.revokeObjectURL(url);
                },
                
                emailResults() {
                    const text = this.formatResultsAsText();
                    const subject = `BA Analysis: ${this.meetingType.charAt(0).toUpperCase() + this.meetingType.slice(1)} Meeting - ${new Date().toLocaleDateString()}`;
                    const body = encodeURIComponent(text);
                    const mailtoLink = `mailto:?subject=${encodeURIComponent(subject)}&body=${body}`;
                    window.location.href = mailtoLink;
                }
            }
        }

        // Make function available globally
        window.baAssistant = baAssistant;
    </script>
</body>
</html>